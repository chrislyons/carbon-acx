import{r as n,j as e}from"./index-CmW8Jgfs.js";import{i as R,A as $,P as M,G as D,D as U}from"./DataUniverseWrapper-CxOdPet-.js";import{c as I,g as B,u as G,h as w,B as N,t as L}from"./NewApp-BqazA668.js";import{D as V,G as H,C as Y}from"./ComparisonOverlay-D9ru8Icd.js";import{T as F}from"./trending-up-Ji8bJILu.js";/**
 * @license lucide-react v0.447.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=I("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),P=n.forwardRef(({data:l,baselineData:a,milestones:u=[],yAxisLabel:m="Emissions",unit:y="kg CO₂e",height:p="500px",enableZoom:b=!0,showArea:c=!0,smooth:g=!0,theme:i,loading:C=!1,onChartReady:x,className:z},f)=>{const d=n.useRef(null),v=n.useRef(null),j=n.useMemo(()=>i||(typeof window<"u"&&(document.documentElement.dataset.theme==="dark"||document.documentElement.classList.contains("dark"))?"dark":"light"),[i]),k=n.useMemo(()=>{const r=[{name:"Actual",type:"line",smooth:g,data:l.map(s=>[s.timestamp,s.value]),itemStyle:{color:"var(--color-baseline)"},lineStyle:{width:3},areaStyle:c?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.05)"}]}}:void 0,emphasis:{focus:"series"}}];a&&a.length>0&&r.push({name:"Baseline",type:"line",smooth:g,data:a.map(s=>[s.timestamp,s.value]),itemStyle:{color:"var(--carbon-neutral)"},lineStyle:{type:"dashed",width:2},emphasis:{focus:"series"}});const o=u.map(s=>{const S={success:"var(--carbon-low)",warning:"var(--carbon-moderate)",info:"var(--interactive-primary)"};return{name:s.label,coord:[s.timestamp,0],value:s.label,itemStyle:{color:S[s.type||"info"]},label:{show:!0,position:"top",formatter:s.label,fontSize:11,color:"var(--text-secondary)"}}}),h={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"var(--surface-elevated)"}},formatter:s=>{if(!Array.isArray(s))return"";let A=`<strong>${new Date(s[0].value[0]).toLocaleDateString()}</strong><br/>`;return s.forEach(E=>{const T=E.value[1].toFixed(2);A+=`${E.marker} ${E.seriesName}: ${T} ${y}<br/>`}),A}},legend:{data:a?["Actual","Baseline"]:["Actual"],top:10,textStyle:{color:"var(--text-primary)"}},grid:{left:"10%",right:"10%",bottom:b?"20%":"10%",top:"15%",containLabel:!0},xAxis:{type:"time",boundaryGap:!1,axisLine:{lineStyle:{color:"var(--border-default)"}},axisLabel:{color:"var(--text-secondary)",formatter:s=>new Date(s).toLocaleDateString("en-US",{month:"short",year:"numeric"})},splitLine:{show:!1}},yAxis:{type:"value",name:`${m} (${y})`,nameLocation:"middle",nameGap:50,nameTextStyle:{color:"var(--text-secondary)",fontSize:12},axisLine:{lineStyle:{color:"var(--border-default)"}},axisLabel:{color:"var(--text-secondary)",formatter:s=>s>=1e3?`${(s/1e3).toFixed(1)}k`:s.toString()},splitLine:{lineStyle:{color:"var(--border-subtle)"}}},series:r,animation:!0,animationDuration:1e3,animationEasing:"cubicOut"};return b&&(h.dataZoom=[{type:"slider",show:!0,xAxisIndex:0,start:0,end:100,height:30,bottom:10,borderColor:"var(--border-default)",fillerColor:"rgba(59, 130, 246, 0.2)",handleStyle:{color:"var(--interactive-primary)"},textStyle:{color:"var(--text-secondary)"}},{type:"inside",xAxisIndex:0,start:0,end:100}]),u.length>0&&r.length>0&&(r[0].markPoint={data:o,symbol:"pin",symbolSize:50}),h},[l,a,u,m,y,b,c,g]);n.useEffect(()=>{if(!d.current)return;const r=R(d.current,j,{renderer:"canvas"});return v.current=r,x&&x(r),()=>{r.dispose(),v.current=null}},[j,x]),n.useEffect(()=>{const r=v.current;r&&r.setOption(k,{notMerge:!1,lazyUpdate:!1})},[k]),n.useEffect(()=>{const r=v.current;r&&(C?r.showLoading("default",{text:"Loading timeline...",color:"var(--interactive-primary)",textColor:"var(--text-primary)",maskColor:"var(--surface-bg)"}):r.hideLoading())},[C]),n.useEffect(()=>{const r=v.current;if(!r)return;const o=()=>{r.resize()};window.addEventListener("resize",o);const h=new ResizeObserver(o);return d.current&&h.observe(d.current),()=>{window.removeEventListener("resize",o),h.disconnect()}},[]);const t=n.useMemo(()=>({height:typeof p=="number"?`${p}px`:p}),[p]);return e.jsx("div",{ref:d,style:t,className:B("relative",z),role:"img","aria-label":"Timeline visualization showing historical carbon emissions"})});P.displayName="TimelineViz";function Q(l,a){try{const u=["Activity Name","Category","Quantity","Unit","Carbon Intensity (kg CO₂/unit)","Annual Emissions (kg CO₂)","Added Date"],m=l.map(i=>[O(i.name),O(i.category||"N/A"),i.quantity.toString(),O(i.unit),i.carbonIntensity.toFixed(3),i.annualEmissions.toFixed(2),new Date(i.addedAt).toLocaleDateString()]);m.push(["TOTAL","","","","",a.toFixed(2),""]);const y=[u.join(","),...m.map(i=>i.join(","))].join(`
`),p=new Blob([y],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(p),c=document.createElement("a"),g=new Date().toISOString().split("T")[0];c.href=b,c.download=`carbon-emissions-${g}.csv`,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(b)}catch(u){throw console.error("Failed to export CSV:",u),new Error("Failed to export CSV file")}}function O(l){return l?l.includes(",")||l.includes('"')||l.includes(`
`)?`"${l.replace(/"/g,'""')}"`:l:""}function _(){const l=G(),[a,u]=n.useState("universe"),[m,y]=n.useState([]),[p,b]=n.useState(!1),[c,g]=n.useState(null);w(t=>t.profile);const i=w(t=>t.profile.layers),C=w(t=>t.getTotalEmissions),x=w(t=>t.activities),z=w(t=>t.profile.emissionsHistory),f=C(),d=n.useMemo(()=>{const t=[];if(z.length===0)return{dataPoints:[],milestones:[]};const r=z.map(o=>({timestamp:o.timestamp.split("T")[0],value:o.totalEmissions,breakdown:o.breakdown||{}}));if(r.length>0&&(t.push({timestamp:r[0].timestamp,label:"Baseline Established",value:r[0].value,description:"Initial carbon footprint calculated"}),r.length>1)){const o=r[r.length-1];t.push({timestamp:o.timestamp,label:"Current",value:o.value,description:"Latest emissions data"})}return{dataPoints:r,milestones:t}},[z]),v=n.useMemo(()=>{if(d.dataPoints.length<2)return null;const t=d.dataPoints[0].value,r=d.dataPoints[d.dataPoints.length-1].value;return t===0?null:(r-t)/t*100},[d.dataPoints]),j=n.useMemo(()=>{if(m.length===0){const S={title:{text:"Your Emissions",left:"center",top:10},series:[{type:"pie",radius:["40%","70%"],data:[{value:f*.25,name:"Commute"},{value:f*.35,name:"Diet"},{value:f*.25,name:"Energy"},{value:f*.15,name:"Shopping"}],color:["var(--carbon-low)","var(--carbon-moderate)","var(--carbon-high)","var(--carbon-neutral)"]}]},A={title:{text:"Global Average",left:"center",top:10},series:[{type:"pie",radius:["40%","70%"],data:[{value:4500*.2,name:"Commute"},{value:4500*.3,name:"Diet"},{value:4500*.3,name:"Energy"},{value:4500*.2,name:"Shopping"}],color:["var(--carbon-low)","var(--carbon-moderate)","var(--carbon-high)","var(--carbon-neutral)"]}]};return{leftOption:S,rightOption:A}}const t=i.find(s=>s.id===m[0]),r=i.find(s=>s.id===m[1]);if(!t||!r)return null;const o={title:{text:t.name,left:"center",top:10},series:[{type:"bar",data:t.activities.map(s=>({value:s.annualEmissions,name:s.name})),color:t.color}],xAxis:{type:"category",data:t.activities.map(s=>s.name)},yAxis:{type:"value"}},h={title:{text:r.name,left:"center",top:10},series:[{type:"bar",data:r.activities.map(s=>({value:s.annualEmissions,name:s.name})),color:r.color}],xAxis:{type:"category",data:r.activities.map(s=>s.name)},yAxis:{type:"value"}};return{leftOption:o,rightOption:h}},[m,i,f]),k=()=>{if(x.length===0){L.error("No activities to export. Add some activities first!");return}try{Q(x,f),L.success("Data exported successfully!")}catch(t){console.error("Export failed:",t),L.error("Failed to export data. Please try again.")}};return e.jsxs("div",{className:"min-h-screen bg-[var(--surface-bg)]",children:[e.jsx($,{}),e.jsxs("div",{className:"p-[var(--space-8)]",children:[e.jsxs("div",{className:"max-w-7xl mx-auto mb-[var(--space-8)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-[var(--space-6)]",children:[e.jsx("h1",{className:"font-bold",style:{fontSize:"var(--font-size-3xl)",color:"var(--text-primary)"},children:"Explore Emissions"}),e.jsxs("div",{className:"flex items-center gap-[var(--space-2)]",children:[e.jsx(N,{variant:"primary",size:"sm",onClick:()=>l("/calculator"),icon:e.jsx(M,{className:"w-4 h-4"}),children:"Add Activities"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>b(!p),icon:e.jsx(q,{className:"w-4 h-4"}),children:"Filters"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:k,icon:e.jsx(V,{className:"w-4 h-4"}),children:"Export"})]})]}),e.jsxs("div",{className:"inline-flex rounded-[var(--radius-md)] p-1",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)"},children:[e.jsxs("button",{onClick:()=>u("universe"),className:"px-4 py-2 rounded-[var(--radius-sm)] flex items-center gap-2 transition-colors",style:{backgroundColor:a==="universe"?"var(--interactive-primary)":"transparent",color:a==="universe"?"white":"var(--text-secondary)"},children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{style:{fontSize:"var(--font-size-sm)"},children:"3D Universe"})]}),e.jsxs("button",{onClick:()=>u("timeline"),className:"px-4 py-2 rounded-[var(--radius-sm)] flex items-center gap-2 transition-colors",style:{backgroundColor:a==="timeline"?"var(--interactive-primary)":"transparent",color:a==="timeline"?"white":"var(--text-secondary)"},children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{style:{fontSize:"var(--font-size-sm)"},children:"Timeline"})]}),e.jsxs("button",{onClick:()=>u("comparison"),className:"px-4 py-2 rounded-[var(--radius-sm)] flex items-center gap-2 transition-colors",style:{backgroundColor:a==="comparison"?"var(--interactive-primary)":"transparent",color:a==="comparison"?"white":"var(--text-secondary)"},children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{style:{fontSize:"var(--font-size-sm)"},children:"Compare"})]})]})]}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[a==="universe"&&e.jsx("div",{className:"rounded-[var(--radius-lg)] overflow-hidden",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)",height:"600px"},children:x.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center max-w-md px-8",children:[e.jsx(D,{className:"w-16 h-16 mx-auto mb-4 opacity-30",style:{color:"var(--text-tertiary)"}}),e.jsx("h3",{className:"font-semibold mb-2",style:{fontSize:"var(--font-size-lg)",color:"var(--text-primary)"},children:"No Activities to Visualize"}),e.jsx("p",{className:"mb-6",style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:"Add activities to your baseline to see them visualized in 3D space. Each activity will appear as an orbiting sphere."}),e.jsx(N,{variant:"primary",size:"md",onClick:()=>l("/calculator"),children:"Add Activities"})]})}):e.jsx(U,{totalEmissions:f,activities:x.map(t=>({id:t.id,name:t.name,annualEmissions:t.annualEmissions,category:t.category??void 0})),onActivityClick:g})}),a==="timeline"&&e.jsx("div",{className:"p-[var(--space-6)] rounded-[var(--radius-lg)]",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)"},children:d.dataPoints.length===0?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsxs("div",{className:"text-center max-w-md px-8",children:[e.jsx(F,{className:"w-16 h-16 mx-auto mb-4 opacity-30",style:{color:"var(--text-tertiary)"}}),e.jsx("h3",{className:"font-semibold mb-2",style:{fontSize:"var(--font-size-lg)",color:"var(--text-primary)"},children:"No Emissions History Yet"}),e.jsx("p",{className:"mb-6",style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:"Activity changes will be tracked over time. Add or modify activities to start building your emissions history."}),e.jsx(N,{variant:"primary",size:"md",onClick:()=>l("/calculator"),children:"Add Activities"})]})}):e.jsx(P,{data:d.dataPoints,milestones:d.milestones,height:"500px",enableZoom:!0})}),a==="comparison"&&e.jsx("div",{className:"p-[var(--space-6)] rounded-[var(--radius-lg)]",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)"},children:j?e.jsx(Y,{baseline:{label:"Baseline",option:j.leftOption},comparison:{label:"Comparison",option:j.rightOption},height:"500px"}):e.jsx("div",{className:"text-center p-12",children:e.jsx("p",{style:{fontSize:"var(--font-size-lg)",color:"var(--text-secondary)"},children:"Select two layers to compare, or view comparison with global average"})})}),e.jsx("div",{className:"mt-[var(--space-6)] p-[var(--space-6)] rounded-[var(--radius-lg)]",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",style:{fontSize:"var(--font-size-base)",color:"var(--text-primary)"},children:a==="universe"&&c?c.name:"Total Emissions"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"font-bold",style:{fontSize:"var(--font-size-3xl)",color:"var(--text-primary)"},children:a==="universe"&&c?(c.annualEmissions/1e3).toFixed(2):(f/1e3).toFixed(1)}),e.jsx("span",{style:{fontSize:"var(--font-size-base)",color:"var(--text-secondary)"},children:"tonnes CO₂/year"})]})]}),a==="universe"&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:"Activities"}),e.jsx("div",{className:"font-bold",style:{fontSize:"var(--font-size-xl)",color:"var(--text-primary)"},children:x.length})]}),a==="timeline"&&v!==null&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"mb-1",style:{fontSize:"var(--font-size-sm)",color:"var(--text-secondary)"},children:"Change (since start)"}),e.jsxs("div",{className:"font-bold",style:{fontSize:"var(--font-size-xl)",color:v<0?"var(--carbon-low)":"var(--carbon-high)"},children:[v>0?"+":"",v.toFixed(1),"%"]})]})]})}),p&&e.jsxs("div",{className:"mt-[var(--space-4)] p-[var(--space-6)] rounded-[var(--radius-lg)]",style:{backgroundColor:"var(--surface-elevated)",border:"1px solid var(--border-default)"},children:[e.jsx("h4",{className:"font-semibold mb-[var(--space-4)]",style:{fontSize:"var(--font-size-sm)",color:"var(--text-primary)"},children:"Filter Options"}),a==="comparison"&&i.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",style:{fontSize:"var(--font-size-xs)",color:"var(--text-secondary)"},children:"Select layers to compare:"}),e.jsx("div",{className:"space-y-2",children:i.map(t=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:m.includes(t.id),onChange:r=>{r.target.checked?y(o=>[...o.slice(0,1),t.id]):y(o=>o.filter(h=>h!==t.id))},disabled:m.length>=2&&!m.includes(t.id)}),e.jsx("span",{style:{fontSize:"var(--font-size-sm)",color:"var(--text-primary)"},children:t.name})]},t.id))})]}),a==="timeline"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2",style:{fontSize:"var(--font-size-xs)",color:"var(--text-secondary)"},children:"Date Range:"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded-[var(--radius-md)]",style:{backgroundColor:"var(--surface-bg)",border:"1px solid var(--border-default)",color:"var(--text-primary)",fontSize:"var(--font-size-sm)"},children:[e.jsx("option",{children:"Last 12 months"}),e.jsx("option",{children:"Last 6 months"}),e.jsx("option",{children:"Last 3 months"}),e.jsx("option",{children:"All time"})]})]})]})]})]})]})}export{_ as default};
